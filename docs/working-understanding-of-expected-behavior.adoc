= Working Understanding of Expected Behavior
:reproducible:
:toc:

This document outlines the expected behavior of the `xGhosted.js` script (testable version) and its built output `highlight-potential-problems.js` (Tampermonkey userscript) based on their current implementation and testing.

== Overview

The script modifies the appearance of `<article>` elements on a webpage based on specific conditions related to their content, such as usernames in `<a>` tags. It applies a "ghosted" effect (e.g., reduced opacity) to certain articles and provides a toggle mechanism to show or hide them. The testable version (`xGhosted.js`) is built into the final userscript (`highlight-potential-problems.js`) using a build process.

== Core Functionality

1. **Article Selection**
   - The script targets all `<article>` elements on the page.
   - *Nuance*: When `<article>` elements are nested (i.e., one `<article>` contains another), only the outermost `<article>` elements are selected for processing. Nested `<article>` elements are ignored to prevent redundant or conflicting modifications.

2. **Username Extraction**
   - For each selected (outermost) `<article>`, the script identifies `<a>` tags within it.
   - It extracts the text content of these `<a>` tags, assuming they represent usernames.

3. **Ghosting Logic**
   - If a username matches a predefined condition (e.g., presence in a blocklist), the containing `<article>` is "ghosted."
   - Ghosting is implemented by applying a CSS style (e.g., `opacity: 0.3`) to the outermost `<article>` element.

4. **Toggle Mechanism**
   - A toggle button or UI element is added to the page.
   - Clicking the toggle switches the visibility of ghosted `<article>` elements between fully hidden (e.g., `display: none`) and their ghosted state (e.g., reduced opacity).

== Pseudo-code Representation

[source,pseudo]
----
BEGIN
  SET articles = document.querySelectorAll('article:not(article article)')
  FOR each article in articles
    SET links = article.querySelectorAll('a')
    FOR each link in links
      SET username = link.textContent
      IF username is in blocklist THEN
        SET article.style.opacity = '0.3'
        MARK article as ghosted
      END IF
    END FOR
  END FOR

  ADD toggleButton to document
  ON toggleButton click
    FOR each ghosted article
      IF hidden THEN
        SET article.style.display = 'block'
      ELSE
        SET article.style.display = 'none'
      END IF
    END FOR
  END ON
END
----

== Implementation Details

- The testable version (`src/xGhosted.js`) contains the core logic and is validated by tests in `src/xGhosted.test.js`.
- The final userscript (`src/highlight-potential-problems.js`) is generated from `src/highlight-potential-problems-template.js` using `build.js`, incorporating the logic from `xGhosted.js`.
- The `:not(article article)` selector in `xGhosted.js` ensures only top-level `<article>` elements are targeted, and this behavior is preserved in the built userscript.

== Key Notes

- Styling values (e.g., `opacity: 0.3`, `display: none`) are placeholders based on typical ghosting behavior and may be adjusted in the actual script.
- The blocklist is assumed to be a predefined list of usernames (implementation details may vary and are handled in the build process).

== Testing Validation

- Tests in `src/xGhosted.test.js` confirm that only outermost `<article>` elements are ghosted, even when nested `<article>` tags exist.
- Toggle functionality is verified to correctly switch visibility states.
- Edge cases, such as empty `<article>` elements or missing `<a>` tags, are handled gracefully.

== Future Considerations

- The script assumes a static page structure; dynamic content loading may require additional event listeners.
- The blocklist source and update mechanism are not detailed here and may need clarification in the implementation or build process.