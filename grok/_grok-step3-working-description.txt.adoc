= Grok Step 3: Working Description
:revision-date: March 25, 2025

== Current State
- *UI*: Highlights PROBLEM (red), POTENTIAL_PROBLEM (yellow) posts with eye icons, GOOD (none), UNDEFINED (none). Panel (resizable, draggable) lists flagged posts with Copy, Export CSV (configurable throttle), Import CSV, Clear, and Manual Check buttons. Theme switching polished with tooltips.
- *Core*: Detects post quality via `identifyPost.js` using DOM only, persists state (capped at 1000 articles) with `GM_setValue`/`GM_getValue`. Manual mode default minimizes server activity. Timing values (debounce, throttle) are configurable via constructor.
- *Tests*: `src/xGhosted.test.js`—24 tests pass, fixed for timing initialization and `saveState` alignment. Total 108 tests across 17 suites passing. CSV tests in `src/xGhosted.csv.test.js` deferred due to ESM mocking issues with `writeToClipboard`.
- *Build*: `build-xGhosted.js` uses esbuild to bundle `xGhosted.js` with dependencies, replacing custom script. Manual testing of build output is next.

== End Goal: Version 0.6.1 Features
- CSV export/import/clear done—export throttle configurable, immediate in tests (functional but untested in Jest ESM).
- Manual Check Mode done—toggles via panel, starts enabled, mocked in tests.
- Configurable logging added—`GM_log` or `console.log` set in constructor.
- UI polish done—panel resizable/draggable, theme detection seamless.
- Userscript wrapper done—built with resource limits (1000 articles, configurable timings) and server safety (no requests beyond page load).
- Tab checks for GOOD posts (10s) and 5s-batched collapsing pending (roadmap steps 6+).

== Technical Details
- *Depends On*: `GM_setValue`/`GM_getValue` for persistence, `jest` for testing, JSDOM for DOM mocks, `esbuild` for bundling.
- *Modules*: `xGhosted.js`, `createPanel.js`, `renderPanel.js`, `updateTheme.js`, utils like `postQuality.js`.
- *Build Script*: `build-xGhosted.js` with esbuild, applies resource caps and ensures proper dependency inlining. Rollup transition planned post-manual testing.

== Revision History
- March 23, 2025: Updated for 0.6.1—24 tests pass. CSV export and Manual Check Mode added.
- March 24, 2025: Step 3 done—CSV import/clear added. Step 4 done—UI polished. Step 5 done—userscript wrapper with safety optimizations.
- March 25, 2025: Test suite at 108/108 passing after fixing timing initialization and `saveState` test. Esbuild adopted, timing configurable. Next: manual test of `build-xGhosted.js`.