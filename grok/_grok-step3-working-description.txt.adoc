# Highlight Potential Problems Userscript

This program is a Tampermonkey userscript designed to enhance the browsing experience on X.com by identifying and highlighting potentially problematic posts and their parent articles.

## Overview
- **Name**: Highlight Potential Problems
- **Purpose**: To detect and visually mark posts on X.com that might be problematic (e.g., containing system notices or links to specific communities), and provide a control panel for managing these highlights.
- **Author**: John Welty
- **Version**: 0.6.0
- **Target URL**: Runs on `https://x.com/*`
- **Execution**: Runs when the document is idle (`document-idle`).

## Key Features

### Post Highlighting
- **Detection**: Scans posts (articles) within `div[data-testid="cellInnerDiv"]` elements on X.com.
- **Categories**:
  - *Problematic*: Posts with system notices (e.g., "This post violated the X rules") or links to specific community IDs (e.g., `1889908654133911912`). Highlighted with a red background and border.
  - *Potential*: Posts replying to others on a profile's "with_replies" page with a reply depth less than 10. Highlighted with a yellow background and border.
  - *Safe*: Posts that pass detailed checks without issues. Highlighted with a green background and border.
  - *None*: Default state with no highlighting.
- **Visual Feedback**: Applies CSS styles to indicate the status of each post.

### Post Collapsing
- Option to collapse non-problematic posts on the replies page when enabled, reducing clutter.

### Interactive Panel
- **Location**: A fixed panel on the right side of the screen.
- **Features**:
  - Displays a list of problematic post links.
  - Buttons to copy links to the clipboard, toggle panel visibility, and control collapsing (Start, Stop, Reset).
  - Theme selector (light, dim, dark) that adapts to the pageâ€™s theme or user preference.
- **Dynamic Updates**: Reflects the current count and list of problematic posts.

### Detailed Post Checking
- Replaces the "Share post" button with an eye icon (`ðŸ‘€`) for potential problems.
- Clicking the icon opens the post in a new tab to check its thread for system notices or target community links.
- Updates the postâ€™s highlight based on findings (problematic or safe) and manages the new tab accordingly (keeps open for problems, closes for safe).

### Theme Detection and Adaptation
- Automatically detects the X.com theme (light, dim, dark) based on `data-theme`, classes, or background color.
- Adjusts the panelâ€™s appearance to match the detected theme.

### Monitoring and Debouncing
- Uses a `MutationObserver` to watch for DOM changes in the main content area, triggering checks with a debounce delay (250ms) to optimize performance.

## How It Works

### Initialization
- Creates the control panel and sets up monitoring when the script starts.
- Logs actions using `GM_log` for debugging (available in Tampermonkey).

### Core Logic (`highlightPotentialProblems`)
- Scans all articles on the page.
- Skips fully processed articles to avoid redundant checks.
- Immediately marks posts with notices or target links as problematic.
- On the replies page, identifies potential issues based on reply depth and enables collapsing if configured.
- Updates the panel with new problematic links.

### State Management
- Tracks processed articles (`WeakSet`), fully processed articles (`Set`), and problematic links (`Set`).
- Manages collapsing state and panel visibility.

### UI Manipulation
- Applies highlights and collapses posts using CSS.
- Dynamically builds and styles the panel with buttons and a scrollable link list.

### Error Handling
- Logs errors during execution and DOM access attempts, ensuring the script doesnâ€™t crash if elements are missing or access is restricted.

## Technical Details

### Configuration
- Defines delays, styles, and theme properties in `CONFIG`.
- Customizable panel dimensions and positioning.

### Utilities
- `debounce`: Limits the frequency of highlight checks.
- `detectTheme`: Infers the current theme for UI consistency.
- `articleContainsSystemNotice` and `articleLinksToTargetCommunities`: Check for specific content issues.

### Dependencies
- Requires Tampermonkey (uses `GM_log`).
- Relies on X.comâ€™s DOM structure (e.g., `data-testid="cellInnerDiv"`, specific class names).

## Usage Example
- On visiting `https://x.com/username/with_replies`, the script:
  1. Highlights posts with system notices in red.
  2. Marks shallow replies in yellow and offers a clickable icon to verify them.
  3. Shows a panel listing problematic post URLs, with options to copy or hide it.
  4. Allows collapsing non-problematic posts with a "Start" button.

## Notes
- The script is tailored to X.comâ€™s current structure (as of the codeâ€™s last update) and may need adjustments if the siteâ€™s DOM changes.
- It respects popup blockers by alerting users if new tabs canâ€™t open for verification.

This userscript enhances moderation and content review on X.com by visually flagging issues and providing tools to manage them efficiently.