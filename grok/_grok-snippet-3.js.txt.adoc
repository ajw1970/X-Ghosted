= Snippet 3: createModal Function (Modal for CSV Import)
:revision-date: March 31, 2025

This defines the modal used for importing CSV data, updated to match DOM attribute naming.

[source,javascript]
----
function createModal() {
  const modal = document.createElement('div');
  Object.assign(modal.style, {
    display: 'none',
    position: 'fixed',
    top: '50%',
    left: '50%',
    transform: 'translate(-50%, -50%)',
    background: CONFIG.THEMES[detectTheme()].bg,
    color: CONFIG.THEMES[detectTheme()].text,
    border: `1px solid ${CONFIG.THEMES[detectTheme()].border}`,
    borderRadius: '8px',
    padding: '20px',
    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.2)',
    zIndex: '10000',
    width: '300px',
  });

  const content = document.createElement('div');
  const textarea = document.createElement('textarea');
  Object.assign(textarea.style, {
    width: '100%',
    height: '100px',
    marginBottom: '15px',
    background: CONFIG.THEMES[detectTheme()].bg,
    color: CONFIG.THEMES[detectTheme()].text,
    border: `1px solid ${CONFIG.THEMES[detectTheme()].border}`,
    borderRadius: '4px',
    padding: '4px',
    resize: 'none',
  });

  const buttonContainer = document.createElement('div');
  Object.assign(buttonContainer.style, {
    display: 'flex',
    justifyContent: 'center',
    gap: '15px',
  });

  const submitButton = createButton(
    'Submit',
    getSvgIcon('check'),
    detectTheme(),
    () => {
      const csvText = textarea.value.trim();
      if (!csvText) {
        alert('Please paste CSV data to import.');
        return;
      }
      try {
        const lines = csvText.split('\n').filter((line) => line.trim());
        if (lines.length === 0) {
          alert('No valid data to import.');
          return;
        }

        const startIndex = lines[0].startsWith('"Status","URL"') ? 1 : 0;
        let importedCount = 0;
        for (let i = startIndex; i < lines.length; i++) {
          const line = lines[i];
          const match = line.match(/"([^"]+)","(https:\/\/x\.com[^"]+)"/);
          if (match) {
            const statusWord = match[1];
            const url = match[2];
            const href = url.replace('https://x.com', '');
            const status =
              statusWord === 'unverified'
                ? 'potential_problem'
                : statusWord === 'problem'
                  ? 'problem'
                  : statusWord === 'good'
                    ? 'good'
                    : null;
            if (status) {
              state.allPosts.set(href, status);
              if (status === 'problem') {
                state.problemLinks.add(href);
              }
              importedCount++;
            }
          }
        }
        saveAllPosts();
        updatePanel();
        modal.style.display = 'none';
        textarea.value = '';
        alert(`Successfully imported ${importedCount} posts.`);
        GM_log(`Imported ${importedCount} posts from CSV`);
      } catch (e) {
        GM_log(`Error importing CSV: ${e.message}`);
        alert(
          'Error importing CSV data. Please ensure it matches the expected format.',
        );
      }
    },
  );

  const closeButton = createButton(
    'Close',
    getSvgIcon('close'),
    detectTheme(),
    () => {
      modal.style.display = 'none';
      textarea.value = '';
    },
  );

  buttonContainer.append(submitButton, closeButton);
  content.append(textarea, buttonContainer);
  modal.appendChild(content);
  document.body.appendChild(modal);
  return { modal, textarea };
}
----